!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports&&"function"==typeof require?require("jquery"):jQuery)}(function(e){"use strict";var t={escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(e){var t=document.createElement("div");return t.className=e,t.style.position="absolute",t.style.display="none",t}},n={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};function s(t,n){var i=function(){},o=this,a={ajaxSettings:{},autoSelectFirst:!1,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:s.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:i,onSearchComplete:i,onSearchError:i,preserveInput:!1,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:function(e,t,n){return -1!==e.value.toLowerCase().indexOf(n)},paramName:"query",transformResult:function(t){return"string"==typeof t?e.parseJSON(t):t},showNoSuggestionNotice:!1,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:!1};o.element=t,o.el=e(t),o.suggestions=[],o.badQueries=[],o.selectedIndex=-1,o.currentValue=o.element.value,o.intervalId=0,o.cachedResponse={},o.onChangeInterval=null,o.onChange=null,o.isLocal=!1,o.suggestionsContainer=null,o.noSuggestionsContainer=null,o.options=e.extend({},a,n),o.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},o.hint=null,o.hintValue="",o.selection=null,o.initialize(),o.setOptions(n)}s.utils=t,e.Autocomplete=s,s.formatResult=function(e,n){var s="("+t.escapeRegExChars(n)+")";return e.value.replace(RegExp(s,"gi"),"<strong>$1</strong>")},s.prototype={killerFn:null,initialize:function(){var t,n=this,i="."+n.classes.suggestion,o=n.classes.selected,a=n.options;n.element.setAttribute("autocomplete","off"),n.killerFn=function(t){0===e(t.target).closest("."+n.options.containerClass).length&&(n.killSuggestions(),n.disableKillerFn())},n.noSuggestionsContainer=e('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0),n.suggestionsContainer=s.utils.createNode(a.containerClass),(t=e(n.suggestionsContainer)).appendTo(a.appendTo),"auto"!==a.width&&t.width(a.width),t.on("mouseover.autocomplete",i,function(){n.activate(e(this).data("index"))}),t.on("mouseout.autocomplete",function(){n.selectedIndex=-1,t.children("."+o).removeClass(o)}),t.on("click.autocomplete",i,function(){n.select(e(this).data("index"))}),n.fixPositionCapture=function(){n.visible&&n.fixPosition()},e(window).on("resize.autocomplete",n.fixPositionCapture),n.el.on("keydown.autocomplete",function(e){n.onKeyPress(e)}),n.el.on("keyup.autocomplete",function(e){n.onKeyUp(e)}),n.el.on("blur.autocomplete",function(){n.onBlur()}),n.el.on("focus.autocomplete",function(){n.onFocus()}),n.el.on("change.autocomplete",function(e){n.onKeyUp(e)}),n.el.on("input.autocomplete",function(e){n.onKeyUp(e)})},onFocus:function(){this.fixPosition(),this.options.minChars<=this.el.val().length&&this.onValueChange()},onBlur:function(){this.enableKillerFn()},setOptions:function(t){var n=this,s=n.options;e.extend(s,t),n.isLocal=e.isArray(s.lookup),n.isLocal&&(s.lookup=n.verifySuggestionsFormat(s.lookup)),s.orientation=n.validateOrientation(s.orientation,"bottom"),e(n.suggestionsContainer).css({"max-height":s.maxHeight+"px",width:s.width+"px","z-index":s.zIndex})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var e=this;e.disabled=!0,clearInterval(e.onChangeInterval),e.currentRequest&&e.currentRequest.abort()},enable:function(){this.disabled=!1},fixPosition:function(){var t=e(this.suggestionsContainer),n=t.parent().get(0);if(n===document.body||this.options.forceFixPosition){var s=this.options.orientation,i=t.outerHeight(),o=this.el.outerHeight(),a=this.el.offset(),l={top:a.top,left:a.left};if("auto"===s){var r=e(window).height(),u=e(window).scrollTop(),c=-u+a.top-i;s=Math.max(c,u+r-(a.top+o+i))===c?"top":"bottom"}if("top"===s?l.top+=-i:l.top+=o,n!==document.body){var g,h=t.css("opacity");this.visible||t.css("opacity",0).show(),g=t.offsetParent().offset(),l.top-=g.top,l.left-=g.left,this.visible||t.css("opacity",h).hide()}"auto"===this.options.width&&(l.width=this.el.outerWidth()-2+"px"),t.css(l)}},enableKillerFn:function(){e(document).on("click.autocomplete",this.killerFn)},disableKillerFn:function(){e(document).off("click.autocomplete",this.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions(),e.intervalId=window.setInterval(function(){e.hide(),e.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var e,t=this.el.val().length,n=this.element.selectionStart;return"number"==typeof n?n===t:!document.selection||((e=document.selection.createRange()).moveStart("character",-t),t===e.text.length)},onKeyPress:function(e){if(!this.disabled&&!this.visible&&e.which===n.DOWN&&this.currentValue){this.suggest();return}if(!this.disabled&&this.visible){switch(e.which){case n.ESC:this.el.val(this.currentValue),this.hide();break;case n.RIGHT:if(this.hint&&this.options.onHint&&this.isCursorAtEnd()){this.selectHint();break}return;case n.TAB:if(this.hint&&this.options.onHint){this.selectHint();return}if(-1===this.selectedIndex){this.hide();return}if(this.select(this.selectedIndex),!1===this.options.tabDisabled)return;break;case n.RETURN:if(-1===this.selectedIndex){this.hide();return}this.select(this.selectedIndex);break;case n.UP:this.moveUp();break;case n.DOWN:this.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}},onKeyUp:function(e){var t=this;if(!t.disabled){switch(e.which){case n.UP:case n.DOWN:return}clearInterval(t.onChangeInterval),t.currentValue!==t.el.val()&&(t.findBestHint(),t.options.deferRequestBy>0?t.onChangeInterval=setInterval(function(){t.onValueChange()},t.options.deferRequestBy):t.onValueChange())}},onValueChange:function(){var t,n=this,s=n.options,i=n.el.val(),o=n.getQuery(i);if(n.selection&&n.currentValue!==o&&(n.selection=null,(s.onInvalidateSelection||e.noop).call(n.element)),clearInterval(n.onChangeInterval),n.currentValue=i,n.selectedIndex=-1,s.triggerSelectOnValidInput&&-1!==(t=n.findSuggestionIndex(o))){n.select(t);return}o.length<s.minChars?n.hide():n.getSuggestions(o)},findSuggestionIndex:function(t){var n=-1,s=t.toLowerCase();return e.each(this.suggestions,function(e,t){if(t.value.toLowerCase()===s)return n=e,!1}),n},getQuery:function(t){var n,s=this.options.delimiter;return s?(n=t.split(s),e.trim(n[n.length-1])):t},getSuggestionsLocal:function(t){var n,s=this.options,i=t.toLowerCase(),o=s.lookupFilter,a=parseInt(s.lookupLimit,10);return n={suggestions:e.grep(s.lookup,function(e){return o(e,t,i)})},a&&n.suggestions.length>a&&(n.suggestions=n.suggestions.slice(0,a)),n},getSuggestions:function(t){var n,s,i,o,a=this,l=a.options,r=l.serviceUrl;if(l.params[l.paramName]=t,s=l.ignoreParams?null:l.params,!1!==l.onSearchStart.call(a.element,l.params)){if(e.isFunction(l.lookup)){l.lookup(t,function(e){a.suggestions=e.suggestions,a.suggest(),l.onSearchComplete.call(a.element,t,e.suggestions)});return}a.isLocal?n=a.getSuggestionsLocal(t):(e.isFunction(r)&&(r=r.call(a.element,t)),i=r+"?"+e.param(s||{}),n=a.cachedResponse[i]),n&&e.isArray(n.suggestions)?(a.suggestions=n.suggestions,a.suggest(),l.onSearchComplete.call(a.element,t,n.suggestions)):a.isBadQuery(t)?l.onSearchComplete.call(a.element,t,[]):(a.currentRequest&&a.currentRequest.abort(),o={url:r,data:s,type:l.type,dataType:l.dataType},e.extend(o,l.ajaxSettings),a.currentRequest=e.ajax(o).done(function(e){var n;a.currentRequest=null,n=l.transformResult(e),a.processResponse(n,t,i),l.onSearchComplete.call(a.element,t,n.suggestions)}).fail(function(e,n,s){l.onSearchError.call(a.element,t,e,n,s)}))}},isBadQuery:function(e){if(!this.options.preventBadQueries)return!1;for(var t=this.badQueries,n=t.length;n--;)if(0===e.indexOf(t[n]))return!0;return!1},hide:function(){var t=this;t.visible=!1,t.selectedIndex=-1,clearInterval(t.onChangeInterval),e(t.suggestionsContainer).hide(),t.signalHint(null)},suggest:function(){if(0===this.suggestions.length){this.options.showNoSuggestionNotice?this.noSuggestions():this.hide();return}var t,n,s=this,i=s.options,o=i.groupBy,a=i.formatResult,l=s.getQuery(s.currentValue),r=s.classes.suggestion,u=s.classes.selected,c=e(s.suggestionsContainer),g=e(s.noSuggestionsContainer),h=i.beforeRender,d="",p=function(e,n){var s=e.data[o];return t===s?"":'<div class="autocomplete-group"><strong>'+(t=s)+"</strong></div>"};if(i.triggerSelectOnValidInput&&-1!==(n=s.findSuggestionIndex(l))){s.select(n);return}e.each(s.suggestions,function(e,t){o&&(d+=p(t,l,e)),d+='<div class="'+r+'" data-index="'+e+'">'+a(t,l)+"</div>"}),this.adjustContainerWidth(),g.detach(),c.html(d),e.isFunction(h)&&h.call(s.element,c),s.fixPosition(),c.show(),i.autoSelectFirst&&(s.selectedIndex=0,c.scrollTop(0),c.children().first().addClass(u)),s.visible=!0,s.findBestHint()},noSuggestions:function(){var t=this,n=e(t.suggestionsContainer),s=e(t.noSuggestionsContainer);this.adjustContainerWidth(),s.detach(),n.empty(),n.append(s),t.fixPosition(),n.show(),t.visible=!0},adjustContainerWidth:function(){var t,n=this.options,s=e(this.suggestionsContainer);"auto"===n.width&&(t=this.el.outerWidth()-2,s.width(t>0?t:300))},findBestHint:function(){var t=this.el.val().toLowerCase(),n=null;t&&(e.each(this.suggestions,function(e,s){var i=0===s.value.toLowerCase().indexOf(t);return i&&(n=s),!i}),this.signalHint(n))},signalHint:function(t){var n="",s=this;t&&(n=s.currentValue+t.value.substr(s.currentValue.length)),s.hintValue!==n&&(s.hintValue=n,s.hint=t,(this.options.onHint||e.noop)(n))},verifySuggestionsFormat:function(t){return t.length&&"string"==typeof t[0]?e.map(t,function(e){return{value:e,data:null}}):t},validateOrientation:function(t,n){return t=e.trim(t||"").toLowerCase(),-1===e.inArray(t,["auto","bottom","top"])&&(t=n),t},processResponse:function(e,t,n){var s=this,i=s.options;e.suggestions=s.verifySuggestionsFormat(e.suggestions),!i.noCache&&(s.cachedResponse[n]=e,i.preventBadQueries&&0===e.suggestions.length&&s.badQueries.push(t)),t===s.getQuery(s.currentValue)&&(s.suggestions=e.suggestions,s.suggest())},activate:function(t){var n,s=this,i=s.classes.selected,o=e(s.suggestionsContainer),a=o.find("."+s.classes.suggestion);return(o.find("."+i).removeClass(i),s.selectedIndex=t,-1!==s.selectedIndex&&a.length>s.selectedIndex)?(e(n=a.get(s.selectedIndex)).addClass(i),n):null},selectHint:function(){var t=e.inArray(this.hint,this.suggestions);this.select(t)},select:function(e){this.hide(),this.onSelect(e)},moveUp:function(){var t=this;if(-1!==t.selectedIndex){if(0===t.selectedIndex){e(t.suggestionsContainer).children().first().removeClass(t.classes.selected),t.selectedIndex=-1,t.el.val(t.currentValue),t.findBestHint();return}t.adjustScroll(t.selectedIndex-1)}},moveDown:function(){this.selectedIndex!==this.suggestions.length-1&&this.adjustScroll(this.selectedIndex+1)},adjustScroll:function(t){var n=this.activate(t);if(n){var s,i,o,a=e(n).outerHeight();s=n.offsetTop,o=(i=e(this.suggestionsContainer).scrollTop())+this.options.maxHeight-a,s<i?e(this.suggestionsContainer).scrollTop(s):s>o&&e(this.suggestionsContainer).scrollTop(s-this.options.maxHeight+a),this.options.preserveInput||this.el.val(this.getValue(this.suggestions[t].value)),this.signalHint(null)}},onSelect:function(t){var n=this,s=n.options.onSelect,i=n.suggestions[t];n.currentValue=n.getValue(i.value),n.currentValue===n.el.val()||n.options.preserveInput||n.el.val(n.currentValue),n.signalHint(null),n.suggestions=[],n.selection=i,e.isFunction(s)&&s.call(n.element,i)},getValue:function(e){var t,n,s=this.options.delimiter;return s&&1!==(n=(t=this.currentValue).split(s)).length?t.substr(0,t.length-n[n.length-1].length)+e:e},dispose:function(){this.el.off(".autocomplete").removeData("autocomplete"),this.disableKillerFn(),e(window).off("resize.autocomplete",this.fixPositionCapture),e(this.suggestionsContainer).remove()}},e.fn.autocomplete=e.fn.devbridgeAutocomplete=function(t,n){var i="autocomplete";return 0===arguments.length?this.first().data(i):this.each(function(){var o=e(this),a=o.data(i);"string"==typeof t?a&&"function"==typeof a[t]&&a[t](n):(a&&a.dispose&&a.dispose(),a=new s(this,t),o.data(i,a))})}});